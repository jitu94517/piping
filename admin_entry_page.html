<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Entry â€“ ASME B31.3</title>

<style>
body{font-family:Arial;background:#f2f4f7}
.container{max-width:1200px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center;color:#1f4e79}
h3{color:#1f4e79;margin-top:25px}
.hint{font-size:12px;color:#777;margin-bottom:2px}
input,select{width:100%;padding:6px;margin:5px 0 10px}
button{padding:6px 14px;background:#1f4e79;color:#fff;border:none;cursor:pointer;margin-right:5px}
.hidden{display:none}
hr{margin:25px 0}

/* toast */
#toast{
 position:fixed;bottom:20px;right:20px;
 background:#1f4e79;color:#fff;
 padding:10px 16px;border-radius:4px;
 opacity:0;transition:.3s
}
#toast.show{opacity:1}
</style>
</head>

<body>
<div class="container">

<h2>Admin Entry â€“ ASME B31.3</h2>

<!-- LOGIN -->
<div id="loginBox">
<div class="hint">Admin Password</div>
<input type="password" id="adminPass">
<button onclick="login()">Login</button>
</div>

<div id="panel" class="hidden">

<!-- ================= MATERIAL MASTER ================= -->
<h3>Material Master</h3>
<input id="mFamily" placeholder="Material Family">
<input id="mType" placeholder="Material (CS / SS)">
<input id="mGrades" placeholder="Grades (A106 Gr.B, A106 Gr.C)">
<button onclick="saveMaterial()">Save Material</button>

<hr>

<!-- ================= PIPE TYPE ================= -->
<h3>Pipe Type Master (E Factor)</h3>
<input id="ptypeNames" placeholder="Pipe Types (Seamless, ERW)">
<input id="ptypeEs" placeholder="E Factors (1.0, 0.85)">
<button onclick="savePipeType()">Save Pipe Type</button>

<hr>

<!-- ================= PIPE DIMENSION ================= -->
<h3>Pipe Dimension (NPS â†’ OD)</h3>
<input id="npsList" placeholder="NPS (4,6,8)">
<input id="odList" placeholder="OD mm (114.3,168.3)">
<button onclick="savePipeDim()">Save Dimension</button>

<hr>

<!-- ================= Y FACTOR ================= -->
<h3>Y Factor â€“ ASME B31.3</h3>
<select id="yMaterial"></select>
<input id="yTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="yValues" placeholder="Y Values (0.4,0.45,0.5)">
<button onclick="saveY()">Save Y</button>

<hr>

<!-- ================= W FACTOR ================= -->
<h3>W Factor â€“ ASME B31.3</h3>
<select id="wMaterial"></select>
<input id="wTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="wValues" placeholder="W Values (1.0,0.95,0.9)">
<button onclick="saveW()">Save W</button>

<hr>

<!-- ================= STRESS ================= -->
<h3>Material Basic Allowable Stress (S)</h3>
<select id="sMaterial"></select>
<input id="sTemps" placeholder="Temperature Â°C (50,100,200)">
<input id="sValues" placeholder="Stress MPa (138,130,120)">
<button onclick="saveStress()">Save Stress</button>

<hr>

<button onclick="location.href='admin-data.html'">
ðŸ“„ View Saved Data
</button>

</div>
</div>

<div id="toast">Saved successfully</div>

<script>
const PASSWORD="admin123";

let materialMasterDB=[],pipeTypeDB=[],pipeDimDB=[],yDB=[],wDB=[],stressDB=[];

const split=v=>v.split(",").map(x=>x.trim()).filter(Boolean);
const toast=msg=>{
 const t=document.getElementById("toast");
 t.innerText=msg;t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),2000);
};

function login(){
 if(adminPass.value===PASSWORD){
  loginBox.style.display="none";
  panel.classList.remove("hidden");
  load();
 } else alert("Wrong password");
}

function load(){
 materialMasterDB=JSON.parse(localStorage.getItem("materialMasterDB"))||[];
 pipeTypeDB=JSON.parse(localStorage.getItem("pipeTypeDB"))||[];
 pipeDimDB=JSON.parse(localStorage.getItem("pipeDimDB"))||[];
 yDB=JSON.parse(localStorage.getItem("yDB"))||[];
 wDB=JSON.parse(localStorage.getItem("wDB"))||[];
 stressDB=JSON.parse(localStorage.getItem("stressDB"))||[];

 populateDropdowns();
}

/* ===== DROPDOWN POPULATION ===== */
function populateDropdowns(){
 yMaterial.innerHTML="";
 wMaterial.innerHTML="";
 sMaterial.innerHTML="";

 const uniqYW = [...new Set(
  materialMasterDB.map(m=>`${m.family} | ${m.mat}`)
 )];

 uniqYW.forEach(m=>{
  yMaterial.innerHTML+=`<option value="${m}">${m}</option>`;
  wMaterial.innerHTML+=`<option value="${m}">${m}</option>`;
 });

 materialMasterDB.forEach(m=>{
  const v = `${m.family} | ${m.mat} | ${m.grade}`;
  sMaterial.innerHTML+=`<option value="${v}">${v}</option>`;
 });
}

/* ===== SAVE FUNCTIONS ===== */
function saveMaterial(){
 split(mGrades.value).forEach(g=>{
  materialMasterDB.push({family:mFamily.value,mat:mType.value,grade:g});
 });
 persist();toast("Material saved");
 mFamily.value=mType.value=mGrades.value="";
 populateDropdowns();
}

function savePipeType(){
 const p=split(ptypeNames.value),e=split(ptypeEs.value);
 if(p.length!==e.length){alert("Mismatch");return;}
 p.forEach((x,i)=>pipeTypeDB.push({type:x,E:+e[i]}));
 persist();toast("Pipe type saved");
 ptypeNames.value=ptypeEs.value="";
}

function savePipeDim(){
 const n=split(npsList.value),o=split(odList.value);
 if(n.length!==o.length){alert("Mismatch");return;}
 n.forEach((x,i)=>pipeDimDB.push({nps:x,od:+o[i]}));
 persist();toast("Pipe dimension saved");
 npsList.value=odList.value="";
}

function saveY(){
 const t=split(yTemps.value),v=split(yValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>yDB.push({mat:yMaterial.value,temp:+x,Y:+v[i]}));
 persist();toast("Y factor saved");
 yTemps.value=yValues.value="";
}

function saveW(){
 const t=split(wTemps.value),v=split(wValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>wDB.push({mat:wMaterial.value,temp:+x,W:+v[i]}));
 persist();toast("W factor saved");
 wTemps.value=wValues.value="";
}

function saveStress(){
 const t=split(sTemps.value),v=split(sValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>stressDB.push({mat:sMaterial.value,temp:+x,stress:+v[i]}));
 persist();toast("Stress saved");
 sTemps.value=sValues.value="";
}

function persist(){
 localStorage.setItem("materialMasterDB",JSON.stringify(materialMasterDB));
 localStorage.setItem("pipeTypeDB",JSON.stringify(pipeTypeDB));
 localStorage.setItem("pipeDimDB",JSON.stringify(pipeDimDB));
 localStorage.setItem("yDB",JSON.stringify(yDB));
 localStorage.setItem("wDB",JSON.stringify(wDB));
 localStorage.setItem("stressDB",JSON.stringify(stressDB));
}
</script>
</body>
</html>
