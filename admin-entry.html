<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Entry â€“ ASME B31.3</title>

<style>
body{font-family:Arial;background:#f2f4f7}
.container{max-width:1200px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center;color:#1f4e79}
h3{color:#1f4e79;margin-top:25px}

.hint{font-size:12px;color:#777;margin-bottom:4px}
.helper{font-size:12px;margin:-6px 0 10px}
.helper.ok{color:#2e7d32}
.helper.warn{color:#d32f2f}
.helper.info{color:#1565c0}

label{font-weight:bold}
input,select{width:100%;padding:6px;margin:5px 0 4px}
button{padding:6px 14px;background:#1f4e79;color:#fff;border:none;cursor:pointer;margin-right:5px}
.hidden{display:none}
hr{margin:25px 0}

#toast{
 position:fixed;bottom:20px;right:20px;
 background:#1f4e79;color:#fff;
 padding:10px 16px;border-radius:4px;
 opacity:0;transition:.3s
}
#toast.show{opacity:1}
</style>
</head>

<body>
<div class="container">

<h2>Admin Entry â€“ ASME B31.3</h2>

<!-- LOGIN -->
<div id="loginBox">
<div class="hint">Admin Password</div>
<input type="password" id="adminPass">
<button onclick="login()">Login</button>
</div>

<div id="panel" class="hidden">

<!-- ================= MATERIAL MASTER ================= -->
<h3>Material Master</h3>
<input id="mFamily" placeholder="Material Family">
<input id="mType" placeholder="Material (CS / LTCS / HTCS / SS / Alloy)">
<input id="mGrades" placeholder="Grades (A106 Gr.B, A333 Gr.6)">
<button onclick="saveMaterial()">Save Material</button>

<hr>

<!-- ================= PIPE TYPE MASTER ================= -->
<h3>Pipe Type Master (E Factor)</h3>
<input id="ptypeNames" placeholder="Pipe Types (Seamless, ERW)">
<input id="ptypeEs" placeholder="E Factors (1.0, 0.85)">
<button onclick="savePipeType()">Save Pipe Type</button>

<hr>

<!-- ================= DIMENSIONS & WEIGHTS ================= -->
<h3>Dimensions and Weights of Welded and Seamless Wrought Steel Pipe</h3>
<div class="hint">
As per ASME B36.10 / ASME B36.19  
Leave blank between commas for NON-schedule / NON-identification
</div>

<label>Material Family</label>
<select id="dwFamily">
  <option value="Carbon Steel">Carbon Steel</option>
  <option value="Stainless Steel">Stainless Steel</option>
</select>

<label>Material Type</label>
<select id="dwMaterial">
  <option value="CS">CS / LTCS / HTCS</option>
  <option value="SS">SS / Alloy / Duplex</option>
</select>

<label>NPS (DN) â€“ comma separated</label>
<input id="dwNps" oninput="helperCheck()" placeholder="2,2,2,2">

<div id="hNps" class="helper info"></div>

<label>Identification (optional) â€“ comma separated</label>
<input id="dwIdent" oninput="helperCheck()" placeholder=",,, or STD,,XS">
<div id="hIdent" class="helper info"></div>

<label>Schedule No. (optional) â€“ comma separated</label>
<input id="dwSch" oninput="helperCheck()" placeholder="5,,10,30">
<div id="hSch" class="helper info"></div>

<label>Outside Diameter (mm) â€“ comma separated</label>
<input id="dwOD" oninput="helperCheck()" placeholder="114.3,114.3,114.3,114.3">
<div id="hOD" class="helper info"></div>

<label>Wall Thickness (mm) â€“ comma separated</label>
<input id="dwThk" oninput="helperCheck()" placeholder="3.91,4.78,6.35,7.01">
<div id="hThk" class="helper info"></div>

<label>Plain End Weight (kg/m) â€“ comma separated</label>
<input id="dwWt" oninput="helperCheck()" placeholder="5.44,6.63,8.62,9.54">
<div id="hWt" class="helper info"></div>

<button onclick="saveDimWeight()">Save Dimensions & Weights</button>

<hr>

<!-- ================= Y FACTOR ================= -->
<h3>Y Factor â€“ ASME B31.3</h3>
<select id="yMaterial"></select>
<input id="yTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="yValues" placeholder="Y Values (0.4,0.45,0.5)">
<button onclick="saveY()">Save Y</button>

<hr>

<!-- ================= W FACTOR ================= -->
<h3>W Factor â€“ ASME B31.3</h3>
<select id="wMaterial"></select>
<input id="wTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="wValues" placeholder="W Values (1.0,0.95,0.9)">
<button onclick="saveW()">Save W</button>

<hr>

<!-- ================= STRESS ================= -->
<h3>Material Basic Allowable Stress (S)</h3>
<select id="sMaterial"></select>
<input id="sTemps" placeholder="Temperature Â°C (50,100,200)">
<input id="sValues" placeholder="Stress MPa (138,130,120)">
<button onclick="saveStress()">Save Stress</button>

<hr>

<button onclick="location.href='admin-data.html'">ðŸ“„ View Saved Data</button>

</div>
</div>

<div id="toast">Saved successfully</div>

<script>
const PASSWORD="admin123";

let materialMasterDB = JSON.parse(localStorage.getItem("materialMasterDB")) || [];
let pipeTypeDB       = JSON.parse(localStorage.getItem("pipeTypeDB")) || [];
let pipeDimWeightDB  = JSON.parse(localStorage.getItem("pipeDimWeightDB")) || [];
let yDB              = JSON.parse(localStorage.getItem("yDB")) || [];
let wDB              = JSON.parse(localStorage.getItem("wDB")) || [];
let stressDB         = JSON.parse(localStorage.getItem("stressDB")) || [];

const split = v => v.split(",").map(x=>x.trim());
const toast = msg => {
 const t=document.getElementById("toast");
 t.innerText=msg;
 t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),2000);
};

function login(){
 if(adminPass.value===PASSWORD){
  loginBox.style.display="none";
  panel.classList.remove("hidden");
  populateMaterialDropdowns();
 } else alert("Wrong password");
}

/* ===== AUTO HELPER (unchanged) ===== */
function helperCheck(){
 const fields={
  NPS:split(dwNps.value),
  IDENT:split(dwIdent.value),
  SCH:split(dwSch.value),
  OD:split(dwOD.value),
  THK:split(dwThk.value),
  WT:split(dwWt.value)
 };
 const counts=Object.values(fields).map(a=>a.length);
 const max=Math.max(...counts);

 hNps.innerText=`Rows: ${fields.NPS.length}`;
 hIdent.innerText=`Blank allowed. Rows: ${fields.IDENT.length}`;
 hSch.innerText=`Blank = NON-schedule. Rows: ${fields.SCH.length}`;
 hOD.innerText=`Rows: ${fields.OD.length}`;
 hThk.innerText=`Rows: ${fields.THK.length}`;
 hWt.innerText=`Rows: ${fields.WT.length}`;

 if(!counts.every(c=>c===max)){
  hWt.innerText="âš  Mismatch: All fields must have same rows";
  hWt.className="helper warn";
 }
}

/* ===== SAVE DIM & WEIGHT (FIXED) ===== */
function saveDimWeight(){
 const nps=split(dwNps.value);
 const ident=split(dwIdent.value);
 const sch=split(dwSch.value);
 const od=split(dwOD.value);
 const thk=split(dwThk.value);
 const wt=split(dwWt.value);

 const len=nps.length;
 if([ident,sch,od,thk,wt].some(a=>a.length!==len)){
  alert("Comma count mismatch");
  return;
 }

 const family = dwFamily.value;
 const mat = dwMaterial.value;
 const code = family==="Carbon Steel" ? "B36.10" : "B36.19";

 for(let i=0;i<len;i++){
  pipeDimWeightDB.push({
   materialFamily: family,
   material: mat,
   nps: nps[i],
   identification: ident[i]||"",
   schedule: sch[i]||"",
   od:+od[i],
   thickness:+thk[i],
   weight:+wt[i],
   code: code
  });
 }

 persist();
 toast("Dimensions & Weights saved");

 dwNps.value=dwIdent.value=dwSch.value=dwOD.value=dwThk.value=dwWt.value="";
}

/* ===== OTHER SAVES (unchanged) ===== */
function saveMaterial(){
 split(mGrades.value).filter(Boolean).forEach(g=>{
  materialMasterDB.push({family:mFamily.value,mat:mType.value,grade:g});
 });
 persist(); toast("Material saved");
 mFamily.value=mType.value=mGrades.value="";
 populateMaterialDropdowns();
}

function savePipeType(){
 const p=split(ptypeNames.value),e=split(ptypeEs.value);
 if(p.length!==e.length){alert("Mismatch");return;}
 p.forEach((x,i)=>pipeTypeDB.push({type:x,E:+e[i]}));
 persist(); toast("Pipe type saved");
 ptypeNames.value=ptypeEs.value="";
}

function saveY(){const t=split(yTemps.value),v=split(yValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>yDB.push({mat:yMaterial.value,temp:+x,Y:+v[i]}));
 persist(); toast("Y saved"); yTemps.value=yValues.value="";
}

function saveW(){const t=split(wTemps.value),v=split(wValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>wDB.push({mat:wMaterial.value,temp:+x,W:+v[i]}));
 persist(); toast("W saved"); wTemps.value=wValues.value="";
}

function saveStress(){const t=split(sTemps.value),v=split(sValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>stressDB.push({mat:sMaterial.value,temp:+x,stress:+v[i]}));
 persist(); toast("Stress saved"); sTemps.value=sValues.value="";
}

function populateMaterialDropdowns(){
 yMaterial.innerHTML=wMaterial.innerHTML=sMaterial.innerHTML="";
 const uniq=[...new Set(materialMasterDB.map(m=>`${m.family}|${m.mat}`))];
 uniq.forEach(m=>{
  yMaterial.innerHTML+=`<option>${m}</option>`;
  wMaterial.innerHTML+=`<option>${m}</option>`;
 });
 materialMasterDB.forEach(m=>{
  sMaterial.innerHTML+=`<option>${m.mat} ${m.grade}</option>`;
 });
}

function persist(){
 localStorage.setItem("materialMasterDB",JSON.stringify(materialMasterDB));
 localStorage.setItem("pipeTypeDB",JSON.stringify(pipeTypeDB));
 localStorage.setItem("pipeDimWeightDB",JSON.stringify(pipeDimWeightDB));
 localStorage.setItem("yDB",JSON.stringify(yDB));
 localStorage.setItem("wDB",JSON.stringify(wDB));
 localStorage.setItem("stressDB",JSON.stringify(stressDB));
}
</script>

</body>
</html>
