<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Entry â€“ ASME B31.3</title>

<style>
body{font-family:Arial;background:#f2f4f7}
.container{max-width:1200px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center;color:#1f4e79}
h3{color:#1f4e79;margin-top:25px}
.hint{font-size:12px;color:#777;margin-bottom:4px}
label{font-weight:bold}
input,select{width:100%;padding:6px;margin:5px 0 10px}
button{padding:6px 14px;background:#1f4e79;color:#fff;border:none;cursor:pointer;margin-right:5px}
.hidden{display:none}
hr{margin:25px 0}

/* toast */
#toast{
 position:fixed;bottom:20px;right:20px;
 background:#1f4e79;color:#fff;
 padding:10px 16px;border-radius:4px;
 opacity:0;transition:.3s
}
#toast.show{opacity:1}
</style>
</head>

<body>
<div class="container">

<h2>Admin Entry â€“ ASME B31.3</h2>

<!-- LOGIN -->
<div id="loginBox">
<div class="hint">Admin Password</div>
<input type="password" id="adminPass">
<button onclick="login()">Login</button>
</div>

<div id="panel" class="hidden">

<!-- ================= MATERIAL MASTER ================= -->
<h3>Material Master</h3>
<input id="mFamily" placeholder="Material Family">
<input id="mType" placeholder="Material (CS / SS)">
<input id="mGrades" placeholder="Grades (A106 Gr.B, A106 Gr.C)">
<button onclick="saveMaterial()">Save Material</button>

<hr>

<!-- ================= PIPE TYPE MASTER ================= -->
<h3>Pipe Type Master (E Factor)</h3>
<input id="ptypeNames" placeholder="Pipe Types (Seamless, ERW)">
<input id="ptypeEs" placeholder="E Factors (1.0, 0.85)">
<button onclick="savePipeType()">Save Pipe Type</button>

<hr>

<!-- ================= DIMENSIONS & WEIGHTS ================= -->
<h3>Dimensions and Weights of Welded and Seamless Wrought Steel Pipe</h3>
<div class="hint">
As per ASME B36.10 (Carbon Steel) / ASME B36.19 (Stainless Steel)
</div>

<label>Material Type</label>
<select id="dwMaterial">
  <option value="CS">Carbon Steel (ASME B36.10)</option>
  <option value="SS">Stainless Steel (ASME B36.19)</option>
</select>

<label>NPS (DN) â€“ comma separated</label>
<input id="dwNps" placeholder="e.g. 2,3,4,6">

<label>Identification â€“ comma separated</label>
<input id="dwIdent" placeholder="STD, XS, NON-SCH">

<label>Schedule No. (optional) â€“ comma separated</label>
<input id="dwSch" placeholder="40, 80, ">

<label>Outside Diameter (mm) â€“ comma separated</label>
<input id="dwOD" placeholder="114.3, 168.3, 219.1">

<label>Wall Thickness (mm) â€“ comma separated</label>
<input id="dwThk" placeholder="6.02, 7.11, 8.18">

<label>Plain End Weight (kg/m) â€“ comma separated</label>
<input id="dwWt" placeholder="16.07, 22.30, 27.63">

<button onclick="saveDimWeight()">Save Dimensions & Weights</button>

<hr>

<!-- ================= Y FACTOR ================= -->
<h3>Y Factor â€“ ASME B31.3</h3>
<select id="yMaterial"></select>
<input id="yTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="yValues" placeholder="Y Values (0.4,0.45,0.5)">
<button onclick="saveY()">Save Y</button>

<hr>

<!-- ================= W FACTOR ================= -->
<h3>W Factor â€“ ASME B31.3</h3>
<select id="wMaterial"></select>
<input id="wTemps" placeholder="Temperature Â°C (100,200,300)">
<input id="wValues" placeholder="W Values (1.0,0.95,0.9)">
<button onclick="saveW()">Save W</button>

<hr>

<!-- ================= STRESS ================= -->
<h3>Material Basic Allowable Stress (S)</h3>
<select id="sMaterial"></select>
<input id="sTemps" placeholder="Temperature Â°C (50,100,200)">
<input id="sValues" placeholder="Stress MPa (138,130,120)">
<button onclick="saveStress()">Save Stress</button>

<hr>

<button onclick="location.href='admin-data.html'">
ðŸ“„ View Saved Data
</button>

</div>
</div>

<div id="toast">Saved successfully</div>

<script>
/* ================= AUTH ================= */
const PASSWORD="admin123";

/* ================= DATABASES ================= */
let materialMasterDB = JSON.parse(localStorage.getItem("materialMasterDB")) || [];
let pipeTypeDB       = JSON.parse(localStorage.getItem("pipeTypeDB")) || [];
let pipeDimWeightDB  = JSON.parse(localStorage.getItem("pipeDimWeightDB")) || [];
let yDB              = JSON.parse(localStorage.getItem("yDB")) || [];
let wDB              = JSON.parse(localStorage.getItem("wDB")) || [];
let stressDB         = JSON.parse(localStorage.getItem("stressDB")) || [];

/* ================= UTIL ================= */
const split = v => v.split(",").map(x=>x.trim()).filter(Boolean);
const toast = msg => {
 const t=document.getElementById("toast");
 t.innerText=msg;
 t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),2000);
};

/* ================= LOGIN ================= */
function login(){
 if(adminPass.value===PASSWORD){
  loginBox.style.display="none";
  panel.classList.remove("hidden");
  populateMaterialDropdowns();
 } else alert("Wrong password");
}

/* ================= MATERIAL MASTER ================= */
function saveMaterial(){
 split(mGrades.value).forEach(g=>{
  materialMasterDB.push({
   family:mFamily.value,
   mat:mType.value,
   grade:g
  });
 });
 persist();
 toast("Material saved");
 mFamily.value=mType.value=mGrades.value="";
 populateMaterialDropdowns();
}

/* ================= PIPE TYPE ================= */
function savePipeType(){
 const p=split(ptypeNames.value), e=split(ptypeEs.value);
 if(p.length!==e.length){alert("Mismatch in Pipe Type & E");return;}
 p.forEach((x,i)=>pipeTypeDB.push({type:x,E:+e[i]}));
 persist();
 toast("Pipe type saved");
 ptypeNames.value=ptypeEs.value="";
}

/* ================= DIMENSIONS & WEIGHTS ================= */
function saveDimWeight(){
 const mat = dwMaterial.value;
 const code = mat==="CS" ? "B36.10" : "B36.19";

 const npsArr = split(dwNps.value);
 const idArr  = split(dwIdent.value);
 const schArr = split(dwSch.value);
 const odArr  = split(dwOD.value);
 const thkArr = split(dwThk.value);
 const wtArr  = split(dwWt.value);

 const len = npsArr.length;

 if(
  idArr.length!==len ||
  odArr.length!==len ||
  thkArr.length!==len ||
  wtArr.length!==len
 ){
  alert("Comma count mismatch in Dimensions & Weights");
  return;
 }

 for(let i=0;i<len;i++){
  pipeDimWeightDB.push({
   code:code,
   material:mat,
   nps:npsArr[i],
   identification:idArr[i],
   schedule:schArr[i] || "",
   od:parseFloat(odArr[i]),
   thickness:parseFloat(thkArr[i]),
   weight:parseFloat(wtArr[i])
  });
 }

 persist();
 toast("Dimensions & Weights saved");

 dwNps.value=dwIdent.value=dwSch.value=
 dwOD.value=dwThk.value=dwWt.value="";
}

/* ================= Y / W / STRESS ================= */
function saveY(){
 const t=split(yTemps.value), v=split(yValues.value);
 if(t.length!==v.length){alert("Temp & Y mismatch");return;}
 t.forEach((x,i)=>yDB.push({mat:yMaterial.value,temp:+x,Y:+v[i]}));
 persist(); toast("Y factor saved");
 yTemps.value=yValues.value="";
}

function saveW(){
 const t=split(wTemps.value), v=split(wValues.value);
 if(t.length!==v.length){alert("Temp & W mismatch");return;}
 t.forEach((x,i)=>wDB.push({mat:wMaterial.value,temp:+x,W:+v[i]}));
 persist(); toast("W factor saved");
 wTemps.value=wValues.value="";
}

function saveStress(){
 const t=split(sTemps.value), v=split(sValues.value);
 if(t.length!==v.length){alert("Temp & Stress mismatch");return;}
 t.forEach((x,i)=>stressDB.push({mat:sMaterial.value,temp:+x,stress:+v[i]}));
 persist(); toast("Stress saved");
 sTemps.value=sValues.value="";
}

/* ================= DROPDOWNS ================= */
function populateMaterialDropdowns(){
 yMaterial.innerHTML=wMaterial.innerHTML=sMaterial.innerHTML="";
 const uniqYW=[...new Set(materialMasterDB.map(m=>`${m.family}|${m.mat}`))];
 uniqYW.forEach(m=>{
  yMaterial.innerHTML+=`<option value="${m}">${m}</option>`;
  wMaterial.innerHTML+=`<option value="${m}">${m}</option>`;
 });
 materialMasterDB.forEach(m=>{
  sMaterial.innerHTML+=`
   <option value="${m.family}|${m.mat}|${m.grade}">
    ${m.mat} ${m.grade}
   </option>`;
 });
}

/* ================= SAVE ALL ================= */
function persist(){
 localStorage.setItem("materialMasterDB",JSON.stringify(materialMasterDB));
 localStorage.setItem("pipeTypeDB",JSON.stringify(pipeTypeDB));
 localStorage.setItem("pipeDimWeightDB",JSON.stringify(pipeDimWeightDB));
 localStorage.setItem("yDB",JSON.stringify(yDB));
 localStorage.setItem("wDB",JSON.stringify(wDB));
 localStorage.setItem("stressDB",JSON.stringify(stressDB));
}
</script>

</body>
</html>
