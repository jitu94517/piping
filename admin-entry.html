<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Entry ‚Äì ASME B31.3</title>

<style>
body{font-family:Arial;background:#f2f4f7}
.container{max-width:1300px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center;color:#1f4e79}
h3{color:#1f4e79;margin-top:30px}
label{font-weight:bold}

input,select{
 width:100%;padding:6px;margin:5px 0 10px
}

button{
 padding:6px 16px;
 background:#1f4e79;
 color:#fff;border:none;
 cursor:pointer
}

hr{margin:30px 0}
.hidden{display:none}

/* helper */
.helper{font-size:12px;margin-top:-6px;margin-bottom:10px;color:#555}

/* toast */
#toast{
 position:fixed;bottom:20px;right:20px;
 background:#1f4e79;color:#fff;
 padding:10px 16px;border-radius:4px;
 opacity:0;transition:.3s
}
#toast.show{opacity:1}
</style>
</head>

<body>
<div class="container">

<h2>Admin Entry ‚Äì ASME B31.3</h2>

<!-- LOGIN -->
<div id="loginBox">
<label>Admin Password</label>
<input type="password" id="adminPass">
<button onclick="login()">Login</button>
</div>

<div id="panel" class="hidden">

<!-- ================================================= -->
<!-- MATERIAL MASTER (ROOT) -->
<!-- ================================================= -->
<h3>1Ô∏è‚É£ Material Master (Pipe Master)</h3>

<label>Code & Standard</label>
<input id="mmCode" placeholder="ASME B36.10 / ASME B36.19">

<label>Material Family</label>
<input id="mmFamily" placeholder="Carbon Steel / Stainless Steel">

<label>Material</label>
<input id="mmMaterial" placeholder="CS / LTCS / SS / Alloy Steel">

<label>Grade</label>
<input id="mmGrade" placeholder="A106 Gr.B / A312 TP304">

<button onclick="saveMaterial()">Save Material</button>

<hr>

<!-- ================================================= -->
<!-- PIPE TYPE MASTER -->
<!-- ================================================= -->
<h3>2Ô∏è‚É£ Pipe Type Master (E Factor)</h3>

<label>Pipe Types (comma separated)</label>
<input id="ptypeNames" placeholder="Seamless, ERW, LSAW">

<label>E Factors (comma separated)</label>
<input id="ptypeEs" placeholder="1.0, 0.85, 0.95">

<button onclick="savePipeType()">Save Pipe Type</button>

<hr>

<!-- ================================================= -->
<!-- DIMENSIONS & WEIGHTS -->
<!-- ================================================= -->
<h3>3Ô∏è‚É£ Dimensions and Weights of Welded and Seamless Wrought Steel Pipe</h3>

<div class="helper">
Rule: All comma-based fields must have same number of entries  
Blank allowed using ,, for NON-schedule / NON-identification
</div>

<label>Code & Standard</label>
<select id="dwCode" onchange="loadDWMaterials()"></select>

<label>Material Family</label>
<select id="dwFamily" onchange="loadDWMaterials()"></select>

<label>Material</label>
<select id="dwMaterial" onchange="loadDWMaterials()"></select>

<label>Grade</label>
<select id="dwGrade"></select>

<label>NPS (DN) ‚Äì comma separated</label>
<input id="dwNps" placeholder="2,2,2,2">

<label>Identification ‚Äì comma separated</label>
<input id="dwIdent" placeholder=",,STD,XS">

<label>Schedule No. ‚Äì comma separated</label>
<input id="dwSch" placeholder="5,,10,30">

<label>Outside Diameter (mm) ‚Äì comma separated</label>
<input id="dwOD" placeholder="60.3,60.3,60.3,60.3">

<label>Wall Thickness (mm) ‚Äì comma separated</label>
<input id="dwThk" placeholder="3.91,4.78,6.35,7.01">

<label>Plain End Weight (kg/m) ‚Äì comma separated</label>
<input id="dwWt" placeholder="5.44,6.63,8.62,9.54">

<button onclick="saveDimensions()">Save Dimensions & Weights</button>

<hr>

<!-- ================================================= -->
<!-- Y FACTOR -->
<!-- ================================================= -->
<h3>4Ô∏è‚É£ Y Factor ‚Äì ASME B31.3</h3>

<select id="yMaterial"></select>
<input id="yTemps" placeholder="Temperature ¬∞C (100,200,300)">
<input id="yValues" placeholder="Y values (0.4,0.45,0.5)">
<button onclick="saveY()">Save Y</button>

<hr>

<!-- ================================================= -->
<!-- W FACTOR -->
<!-- ================================================= -->
<h3>5Ô∏è‚É£ W Factor ‚Äì ASME B31.3</h3>

<select id="wMaterial"></select>
<input id="wTemps" placeholder="Temperature ¬∞C (100,200,300)">
<input id="wValues" placeholder="W values (1.0,0.95,0.9)">
<button onclick="saveW()">Save W</button>

<hr>

<!-- ================================================= -->
<!-- STRESS -->
<!-- ================================================= -->
<h3>6Ô∏è‚É£ Material Basic Allowable Stress (S)</h3>

<select id="sMaterial"></select>
<input id="sTemps" placeholder="Temperature ¬∞C (50,100,200)">
<input id="sValues" placeholder="Stress MPa (138,130,120)">
<button onclick="saveStress()">Save Stress</button>

<hr>

<button onclick="location.href='admin-data.html'">üìÑ View Saved Data</button>

</div>
</div>

<div id="toast">Saved successfully</div>

<script>
/* ================= AUTH ================= */
const PASSWORD="admin123";

/* ================= DATABASE ================= */
let materialMasterDB = JSON.parse(localStorage.getItem("materialMasterDB")) || [];
let pipeTypeDB       = JSON.parse(localStorage.getItem("pipeTypeDB")) || [];
let pipeDimWeightDB  = JSON.parse(localStorage.getItem("pipeDimWeightDB")) || [];
let yDB              = JSON.parse(localStorage.getItem("yDB")) || [];
let wDB              = JSON.parse(localStorage.getItem("wDB")) || [];
let stressDB         = JSON.parse(localStorage.getItem("stressDB")) || [];

/* ================= UTIL ================= */
const split = v => v.split(",").map(x=>x.trim());
const toast = msg=>{
 const t=document.getElementById("toast");
 t.innerText=msg; t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),2000);
};
const saveAll = ()=>{
 localStorage.setItem("materialMasterDB",JSON.stringify(materialMasterDB));
 localStorage.setItem("pipeTypeDB",JSON.stringify(pipeTypeDB));
 localStorage.setItem("pipeDimWeightDB",JSON.stringify(pipeDimWeightDB));
 localStorage.setItem("yDB",JSON.stringify(yDB));
 localStorage.setItem("wDB",JSON.stringify(wDB));
 localStorage.setItem("stressDB",JSON.stringify(stressDB));
 populateDropdowns();
};

/* ================= LOGIN ================= */
function login(){
 if(adminPass.value===PASSWORD){
  loginBox.style.display="none";
  panel.classList.remove("hidden");
  populateDropdowns();
 } else alert("Wrong password");
}

/* ================= MATERIAL MASTER ================= */
function saveMaterial(){
 materialMasterDB.push({
  code:mmCode.value,
  family:mmFamily.value,
  mat:mmMaterial.value,
  grade:mmGrade.value
 });
 saveAll(); toast("Material saved");
 mmCode.value=mmFamily.value=mmMaterial.value=mmGrade.value="";
}

/* ================= PIPE TYPE ================= */
function savePipeType(){
 const p=split(ptypeNames.value), e=split(ptypeEs.value);
 if(p.length!==e.length){alert("Mismatch");return;}
 p.forEach((x,i)=>pipeTypeDB.push({type:x,E:+e[i]}));
 saveAll(); toast("Pipe type saved");
 ptypeNames.value=ptypeEs.value="";
}

/* ================= DIMENSIONS ================= */
function saveDimensions(){
 const nps=split(dwNps.value),
 ident=split(dwIdent.value),
 sch=split(dwSch.value),
 od=split(dwOD.value),
 thk=split(dwThk.value),
 wt=split(dwWt.value);

 const len=nps.length;
 if([ident,sch,od,thk,wt].some(a=>a.length!==len)){
  alert("Comma count mismatch"); return;
 }

 for(let i=0;i<len;i++){
  pipeDimWeightDB.push({
   code:dwCode.value,
   family:dwFamily.value,
   material:dwMaterial.value,
   grade:dwGrade.value,
   nps:nps[i],
   identification:ident[i]||"",
   schedule:sch[i]||"",
   od:+od[i],
   thickness:+thk[i],
   weight:+wt[i]
  });
 }

 saveAll(); toast("Dimensions saved");
 dwNps.value=dwIdent.value=dwSch.value=dwOD.value=dwThk.value=dwWt.value="";
}

/* ================= Y / W / STRESS ================= */
function saveY(){const t=split(yTemps.value),v=split(yValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>yDB.push({mat:yMaterial.value,temp:+x,Y:+v[i]}));
 saveAll(); toast("Y saved"); yTemps.value=yValues.value="";
}

function saveW(){const t=split(wTemps.value),v=split(wValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>wDB.push({mat:wMaterial.value,temp:+x,W:+v[i]}));
 saveAll(); toast("W saved"); wTemps.value=wValues.value="";
}

function saveStress(){const t=split(sTemps.value),v=split(sValues.value);
 if(t.length!==v.length){alert("Mismatch");return;}
 t.forEach((x,i)=>stressDB.push({mat:sMaterial.value,temp:+x,stress:+v[i]}));
 saveAll(); toast("Stress saved"); sTemps.value=sValues.value="";
}

/* ================= DROPDOWNS ================= */
function populateDropdowns(){
 dwCode.innerHTML=dwFamily.innerHTML=dwMaterial.innerHTML=dwGrade.innerHTML="";
 yMaterial.innerHTML=wMaterial.innerHTML=sMaterial.innerHTML="";

 materialMasterDB.forEach(m=>{
  dwCode.innerHTML+=`<option>${m.code}</option>`;
  dwFamily.innerHTML+=`<option>${m.family}</option>`;
  dwMaterial.innerHTML+=`<option>${m.mat}</option>`;
  dwGrade.innerHTML+=`<option>${m.grade}</option>`;

  yMaterial.innerHTML+=`<option>${m.family}|${m.mat}</option>`;
  wMaterial.innerHTML+=`<option>${m.family}|${m.mat}</option>`;
  sMaterial.innerHTML+=`<option>${m.mat} ${m.grade}</option>`;
 });
}

function loadDWMaterials(){/* kept for future filter enhancement */}
</script>

</body>
</html>
